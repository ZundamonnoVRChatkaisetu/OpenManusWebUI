# OpenManus Web UI 実装計画

## 1. プロジェクト管理機能の修正（2025-03-19）

### 実装前の問題点
- プロジェクト関連ボタンが押しても反応しない
- プロジェクト管理機能のJavaScriptモジュールが適切に統合されていない
- イベントハンドラが正しく接続されていない

### 実装計画
1. プロジェクト管理機能をインターフェースに統合
2. 既存のJavaScriptモジュールを正しくインポート
3. イベントハンドラーの接続と動作確認

### 実装結果
1. ✅ プロジェクト管理機能をインターフェースに統合
   - project_manager.jsモジュールをconnected_interface.jsに正しくインポート
   - プロジェクト管理クラスの初期化と設定

2. ✅ ProjectManagerクラスをES6モジュールとして適切に修正
   - エラーハンドリングの強化
   - console.logによるデバッグ情報の追加
   - ドキュメントの更新

3. ✅ セッション管理機能とチャット機能の連携
   - セッション選択時のイベントハンドリング
   - プロジェクト・セッション情報のAPIリクエストへの統合

## 2. プロジェクトごとのワークスペースファイル管理（2025-03-19）

### 問題点
- プロジェクトを切り替えても同じワークスペースファイルが表示されている
- プロジェクトごとにファイルが分離されていない

### 実装計画
1. プロジェクトとワークスペースディレクトリの関連付け
2. プロジェクト選択時のワークスペースファイル表示の更新
3. プロジェクト間でのファイル分離の仕組みを実装

### 実装結果
1. ✅ プロジェクト専用のワークスペースディレクトリ構造を導入
   - PROJECT_WORKSPACE_ROOT ディレクトリの作成
   - プロジェクトIDに基づくディレクトリ階層の実装

2. ✅ API側でプロジェクトIDに基づくファイル取得機能を追加
   - get_generated_filesエンドポイントの拡張
   - create_workspaceメソッドの改良

3. ✅ フロントエンドでプロジェクト選択に応じたファイル表示の実装
   - WorkspaceManagerクラスにプロジェクトID対応を追加
   - インターフェースとの連携

## 3. Claudeライクなプロジェクト・チャット管理（2025-03-19）

### 要件
- 一つのプロジェクトに複数のチャットを作成できる仕組み
- チャット履歴の保存と表示
- プロジェクト設定のチャットへの適用

### 実装計画
1. チャット履歴の管理機能の実装
2. セッション選択によるチャット切り替え機能
3. プロジェクト指示のチャットへの適用強化

### 実装結果
1. ✅ チャット履歴のデータベース保存・取得機能の強化
   - セッション情報にチャット履歴を含める
   - メッセージ保存機能の強化

2. ✅ セッション選択時にチャット履歴を表示する機能
   - loadChatHistory メソッドの実装
   - ChatManagerへの履歴表示機能の追加

3. ✅ インターフェースの改良
   - message-header の追加（Claudeライク）
   - チャット履歴表示の最適化

4. ✅ ProjectManagerクラスの機能拡張
   - 現在のプロジェクト・セッションデータの管理
   - プロジェクト切り替え時の処理改善

## 4. プロジェクト指示保持と削除・名前変更機能（2025-03-20）

### 実装前の問題点
- プロジェクトを切り替えると、記載したプロジェクトの指示が消えてしまう
- 作成したプロジェクトとセッションを削除・名前変更できない

### 実装計画
1. プロジェクト指示の保持機能強化
   - プロジェクト切り替え時の指示保持メカニズムの実装
   - プロジェクト指示の表示と更新の改善

2. プロジェクト・セッションの削除機能追加
   - プロジェクト削除機能のUI実装
   - セッション削除機能のUI実装
   - 削除前の確認ダイアログの追加

3. プロジェクト・セッションの名前変更機能追加
   - プロジェクト名編集機能のUI実装
   - セッション名編集機能のUI実装
   - 名前変更のAPI連携実装

### 実装結果
1. ✅ プロジェクト指示の保持機能強化
   - ProjectManagerクラスの更新
   - 内部状態管理の強化でプロジェクト指示を保持
   - 保存処理の最適化

2. ✅ プロジェクト・セッションの削除機能実装
   - database.py にセッション削除関数を追加
   - app.py にセッション削除APIエンドポイントを追加
   - ProjectManagerクラスに削除機能を実装
   - 確認ダイアログの実装

3. ✅ プロジェクト・セッションの名前変更機能実装
   - ProjectManagerクラスに名前変更機能を実装
   - HTML/CSSの更新
   - 多言語対応（i18n.js更新）

4. ✅ UI改良
   - セッション情報表示エリアの追加
   - ボタンのデザイン改善
   - 操作フィードバックの強化

## 5. LMStudioサーバーの自動起動機能（2025-03-20）

### 実装前の問題点
- OpenManusWebUIを起動するたびに、別途LMStudioサーバーを手動で起動する必要があった
- LLMの設定が煩雑で、使い始めのハードルが高かった

### 実装計画
1. web_run.pyにLMStudioサーバー起動機能を追加
2. コマンドラインオプションの拡張
3. プロセス管理とクリーンアップ機能の実装

### 実装結果
1. ✅ LMStudioサーバー起動機能
   - 複数OS対応（Windows、macOS、Linux）
   - 実行ファイル自動検出機能
   - コマンドラインオプション（--lmstudio）の追加

2. ✅ プロセス制御機能強化
   - シグナルハンドラーによる適切な終了処理
   - 標準出力・エラー出力の非同期キャプチャ
   - ロギング機能の充実化

3. ✅ 使い勝手の改善
   - カスタムポート設定オプションの追加
   - GUIモード / サーバーのみモード選択
   - わかりやすいステータス表示

## 6. LMStudioサーバー起動時のエンコーディング問題修正（2025-03-20）

### 実装前の問題点
- Windows日本語環境でLMStudioサーバーを起動すると、UnicodeDecodeError（cp932 codec）が発生
- プロセス出力の読み取り処理でエンコーディングの不一致が原因でスクリプトが異常終了
- LMStudioが「アプリケーションが応答していません」という状態になる

### 実装計画
1. プロセス出力のエンコーディング処理の修正
2. より堅牢なエラーハンドリングの追加

### 実装結果
1. ✅ エンコーディング処理の改善
   - サブプロセス起動時のtext=Falseでバイナリモードに変更
   - io.TextIOWrapperを使って明示的にUTF-8でデコード
   - errors='replace'オプションで不正な文字シーケンスを安全に置換

2. ✅ 堅牢性の向上
   - バイナリ出力からテキストへの適切な変換処理
   - エンコーディングエラーの適切な処理
   - マルチプラットフォーム対応の強化

## 7. LLMAPIリクエストのタイムアウト改善（2025-03-20）

### 実装前の問題点
- チャットの応答を待っている間に「API error: Request timed out.」エラーが発生
- 特に長文やコード生成を要求する複雑なプロンプトで頻繁に発生
- デフォルトのタイムアウト設定（60秒）が短すぎる

### 実装計画
1. APIリクエストのタイムアウト値を増加
2. エラーログの詳細化と改善
3. LM Studio設定の最適化

### 実装結果
1. ✅ タイムアウト設定の改善
   - ask_tool関数のタイムアウト値を60秒から120秒に増加
   - タイムアウト値のドキュメント更新

2. ✅ ログ出力の強化
   - リクエスト開始・完了時のログ追加
   - エラー詳細の出力改善（例外タイプの明示）
   - トラブルシューティングに役立つ診断情報の追加

3. ✅ LM Studio設定の最適化
   - config.example.tomlファイルの更新
   - LM Studioとの互換性を高めるよう設定を調整
   - モデル名とAPIエンドポイントの適切な設定

## 8. Claude MCPライクなツール連携機能（2025-03-20）

### 実装前の問題点
- AIアシスタントに外部ツールやサービスを使用させる仕組みがない
- GitHubなどの外部サービスとの連携機能がない
- 複雑なタスクを実行するための拡張機能が限られている

### 実装計画
1. MCPフレームワークの基本設計
   - ツール連携のための抽象化レイヤーの設計
   - プロンプト内のツールコマンド認識機能
   - ツール実行結果のレスポンスへの統合機能

2. GitHub連携ツールの実装
   - リポジトリ検索・取得機能
   - ファイル操作機能（取得・作成・更新）
   - イシュー・PR管理機能
   - 認証管理機能

3. その他のツール連携機能
   - ファイル分析ツール（CSV、JSON処理など）
   - データ可視化ツール
   - Web検索ツール

4. UIとの統合
   - ツール使用状況の可視化
   - ツール選択・設定インターフェース
   - 実行結果表示の改善

### 実装計画詳細

#### 1. MCPフレームワークの設計と実装
- **APIエンドポイント**: `/api/tools/execute` - ツール実行リクエストを処理するエンドポイント
- **ツール定義**: `app/web/tools/` ディレクトリに各ツールの実装を配置
- **認証管理**: 外部サービスのAPIキーなどを安全に管理する仕組み
- **プロンプト処理**: ユーザープロンプト内のツール呼び出しコマンドを認識するパーサー

#### 2. GitHub連携ツールの詳細設計
- **リポジトリ操作ツール**: リポジトリの検索、クローン、作成機能
- **ファイル操作ツール**: ファイルの取得、作成、更新、削除機能
- **イシュー管理ツール**: イシューの作成、検索、コメント、クローズ機能
- **PR管理ツール**: PRの作成、レビュー、マージ機能

#### 3. フロントエンド統合の詳細設計
- **ツール実行状態表示**: ツール実行中の進捗表示
- **ツール設定UI**: 各ツールの設定を管理するインターフェース
- **ツール実行結果の表示**: 結果を適切に整形して表示する機能

#### 4. セキュリティ対策
- **APIキー管理**: 環境変数や暗号化ストレージによるキー管理
- **実行制限**: 特定のツールへのアクセス制限機能
- **アクセスログ**: ツール使用履歴の記録と管理

### 実装結果

#### 1. ✅ MCPフレームワークの基本実装
- **ツール基本クラス**: `Tool`、`ToolResult`クラスの実装
- **ツールマネージャー**: `ToolManager`クラスの実装
- **APIエンドポイント**: `/api/tools/execute`、`/api/tools/process`エンドポイントの実装
- **設定管理**: ツール設定の保存と読み込み機能

#### 2. ✅ GitHub連携ツールの実装
- **リポジトリ操作**: 検索、情報取得、一覧表示機能
- **ファイル操作**: ファイル取得、作成、更新機能
- **イシュー管理**: イシュー検索、作成機能
- **GitHubクライアント**: APIとの通信を担当するクライアントクラス

#### 3. ✅ Web検索ツールの実装 (2025-03-19)
- **WebSearchTool**: Brave Search APIを利用したWeb検索ツール
- **WebSearchClient**: 検索API通信を担当するクライアントクラス
- **設定管理**: APIキーの管理
- **UI統合**: Web検索設定画面の実装と更新

#### 4. ✅ 設定UIの改善
- **ツール設定画面**: 各ツールの設定を管理するUI
- **設定保存機能**: APIキーなどの設定を安全に保存する機能
- **使用方法表示**: ツールの使用方法を表示するタブ

## 9. GitHub・Web検索API連携問題の修正 (2025-03-20)

### 実装前の問題点
1. GitHub連携が正しく機能せず、「undefined」エラーが発生
2. Web検索機能でBrave Search APIを使用したい

### 実装計画
1. GitHub認証処理の改善
   - 認証ヘッダーの形式を最新の推奨形式に更新
   - 複数環境変数名への対応
   - エラーハンドリングとロギングの強化

2. Web検索APIをGoogle Custom SearchからBrave Search APIに移行
   - APIクライアントの修正
   - レスポンス処理の対応
   - UIの更新

3. 診断ツールの追加
   - クライアント側デバッグモードの実装
   - サーバー側ログの強化

### 実装結果
1. ✅ GitHub連携の改善
   - **Bearer認証**: `Authorization: Bearer <token>`形式への更新
   - **複数環境変数対応**: `GITHUB_PERSONAL_ACCESS_TOKEN`、`GITHUB_ACCESS_TOKEN`、`GITHUB_TOKEN`の3種類をサポート
   - **ユーザー名自動更新**: APIレスポンスから取得したユーザー名で設定を自動更新
   - **エラーハンドリング強化**: 詳細なエラーメッセージとドキュメントリンクの表示

2. ✅ Web検索APIの移行
   - **Brave Search API対応**: クライアント実装の完全移行
   - **パラメータ更新**: `count`、`offset`パラメータへの適応
   - **レスポンス処理**: Brave Search固有のレスポンス形式に合わせた処理
   - **設定UI更新**: 不要なCSE ID項目の削除とAPIキーの説明更新

3. ✅ 診断機能の強化
   - **デバッグパネル**: 設定画面にデバッグモードとログ表示機能を追加
   - **通信ログ**: API通信の詳細なログ出力
   - **設定値検証**: コンソール出力と視覚的フィードバックの追加
   - **環境変数確認**: 設定値と環境変数の整合性チェック

## 10. GitHub検証エンドポイントのHTTPメソッド修正 (2025-03-20)

### 実装前の問題点
- GitHub APIの検証時に「405 Method Not Allowed」エラーが発生
- フロントエンドからGETメソッドでアクセスしているが、サーバー側ではPOSTメソッドのみ実装されている
- エラーメッセージ: `GET /api/tools/verify/github HTTP/1.1" 405 Method Not Allowed`

### 実装計画
1. API検証エンドポイントの改善
   - GETメソッドもサポートするよう拡張
   - 共通処理の関数化による処理の一元化
   - ロギングの強化

2. Webツール検証機能の追加
   - Web検索APIの検証機能も実装
   - テスト検索機能の実装

### 実装結果
1. ✅ API検証エンドポイントの修正
   - **GETメソッド対応**: `/api/tools/verify/{tool_name}` エンドポイントにGETメソッドハンドラーを追加
   - **共通処理化**: 検証ロジックを `_verify_tool_config` 共通関数として実装し、GET/POSTハンドラーから呼び出す設計に変更
   - **詳細なログ出力**: リクエストメソッドと処理結果のログ出力を強化

2. ✅ Web検索ツール検証機能
   - **API検証メソッド**: Brave Search APIへのテスト検索機能を実装
   - **設定検証ロジック**: APIキーとエンドポイントの検証ロジック追加
   - **ユーザーフィードバック**: 検証結果のフィードバック表示を改善

## 11. ログ出力の最適化とフィルタリング (2025-03-20)

### 実装前の問題点
- タスク完了後に大量のHTTPリクエストログが出力される
- 主に`/api/files?project_id=...`や`/api/sessions/...`など頻繁に呼び出されるAPIエンドポイントのログが大量に出力
- ログが多すぎてトラブルシューティングに必要な情報が埋もれてしまう
- FastAPIのデフォルトログ設定ではリクエストごとに詳細なログが出力される

### 実装計画
1. ロギング設定モジュールの作成
   - ログフィルタリングミドルウェアの設計
   - 特定パスのリクエストログを抑制する機能の実装
   - 処理時間ベースのフィルタリング機能の実装

2. アプリケーションへの統合
   - `app.py`にロギング設定モジュールを統合
   - 不要なエンドポイントのログ抑制設定
   - ログレベルとフォーマットの最適化

3. 例外的な条件でのログ出力設定
   - エラー時（HTTPステータスコード4xx/5xx）は常にログ出力
   - 処理時間が長いリクエストのみログ出力する閾値設定

### 実装結果
1. ✅ ロギング設定モジュールの実装
   - **LogFilterMiddleware**: FastAPIミドルウェアとしてログフィルタリング機能を実装
   - **設定可能なフィルタリング**: 頻繁にアクセスされるパスパターンをSILENT_ENDPOINTSに登録
   - **処理時間ベースフィルタリング**: 一定時間（デフォルト1秒）以上かかるリクエストのみログ出力
   - **UvicornロガーのカスタマイズF**: アクセスログのレベルをWARNINGに変更

2. ✅ フィルタリング対象の設定
   - **ファイル取得エンドポイント**: `/api/files`へのアクセスログを抑制
   - **プロジェクト/セッション関連**: `/api/projects/`と`/api/sessions/`へのアクセスログを抑制
   - **静的ファイル**: `/static/`と`/favicon.ico`へのアクセスログを抑制
   - **エラーログの保持**: 400/500系エラーは引き続きログ出力を保持

3. ✅ ログ形式の最適化
   - **処理時間の表示**: リクエスト処理時間をミリ秒単位でログに追加
   - **フォーマットの統一**: アプリケーション全体で統一されたログフォーマットの適用
   - **不要ログの抑制**: httpx、httpcore等の外部ライブラリログをWARNINGレベルに抑制

## 12. ツール設定の永続化問題の修正 (2025-03-20)

### 実装前の問題点
- APIキー（GitHub、Web検索）を設定しても、アプリケーション再起動時に設定が失われる
- 設定ファイルのパスが不適切で、アプリケーションの実行権限がない場所に保存されている
- 設定ファイルのディレクトリにパーミッション問題がある可能性
- ユーザーは毎回APIキーを再入力する必要があり、大きな手間になっている

### 実装計画
1. 設定ファイルの保存場所の改善
   - ユーザーのホームディレクトリを利用した設定保存
   - OSごとの適切なアプリケーション設定ディレクトリの使用
   - フォールバックメカニズムの実装

2. 設定ファイルのパーミッション管理
   - Windowsとその他のOS（Linux、macOS）でのパーミッション設定
   - 安全なファイルアクセス許可の設定
   - ディレクトリが作成できない場合の代替保存場所の実装

3. デバッグと診断機能の強化
   - 設定ファイルのパス表示機能の追加
   - 設定保存・読み込み時のエラー情報の詳細化
   - ユーザー向けトラブルシューティング情報の提供

### 実装結果
1. ✅ クロスプラットフォーム対応設定ディレクトリの実装
   - **Windows**: `%USERPROFILE%\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\OpenManusWebUI`にファイルを保存
   - **macOS**: `~/Library/Application Support/OpenManusWebUI`にファイルを保存
   - **Linux**: `~/.config/openmanus-webui`にファイルを保存
   - **フォールバック**: 通常のディレクトリが使用できない場合は`temp`ディレクトリを使用

2. ✅ パーミッションと安全性の改善
   - **適切なディレクトリパーミッション**: Linuxベースのシステムでユーザー専用のパーミッション設定
   - **設定ファイルのパーミッション**: 所有者のみ読み書き可能に設定
   - **データの整合性チェック**: 設定ファイルの読み書き時のエラーハンドリング強化

3. ✅ デバッグと診断機能
   - **設定パスAPIエンドポイント**: 設定ファイルの保存場所を表示する`/api/tools/config_path`を追加
   - **設定パス表示**: ツール設定画面に現在の設定ファイルパスを表示
   - **エラーログの強化**: 設定ファイルの保存・読み込みエラーの詳細なログ記録

4. ✅ フロントエンド改善
   - **デバッグモード拡張**: 設定画面のデバッグモードで設定パス情報の表示
   - **エラー表示の改善**: APIリクエスト失敗時の詳細なエラーメッセージの表示
   - **APIレスポンス処理の強化**: JSONパースエラーの適切な処理と表示

## 13. モデル処理中の追加指示機能の実装（2025-03-20）

### 実装前の問題点
- モデルがタスクを実行中に、追加の指示を送信できない
- 処理中は送信ボタンが無効化され、新しい指示を出すには処理完了を待つか停止する必要があった
- 参考元の「https://manus.im/app」では処理中でも追加指示が可能であり、効率的な操作が可能

### 実装計画
1. 処理中でも入力を可能にする機能
   - 送信ボタンを常に有効化
   - 処理中フラグの管理を改善
   - 追加指示のキューイングシステム導入

2. メッセージキューイング機能
   - 処理中に送信されたメッセージをキューに格納
   - 前のタスク完了後に自動的に次のタスクを実行
   - キュー管理と状態表示の追加

3. UIフィードバックの改善
   - 現在の処理状態の視覚的フィードバック
   - キューに入れられたメッセージの表示
   - 処理中に追加指示が可能であることの案内表示

### 実装結果
1. ✅ 処理中の入力機能実装
   - **送信ボタン常時有効化**: 処理中でも送信ボタンを無効化しないよう修正
   - **状態表示の改善**: 処理中でも追加指示可能であることを示すステータス表示
   - **多言語対応**: 状態表示の多言語化（日本語・英語・中国語）

2. ✅ メッセージキューイングシステム実装
   - **キュー配列の追加**: `messageQueue` 配列を追加し、処理中に送信されたメッセージを格納
   - **キュー処理機能**: 処理完了時に次のキュー内メッセージを自動的に処理する機能の追加
   - **停止処理改善**: 停止時にキューをクリアする機能を追加

3. ✅ UI/UXの改善
   - **処理状態表示**: 追加指示を受け付けていることがわかるステータスメッセージの追加
   - **システムメッセージ**: キューに追加された場合の通知メッセージ表示
   - **多言語対応**: 新しいメッセージの各言語への翻訳追加

## 14. WebSocket接続時のログ出力抑制（2025-03-21）

### 実装前の問題点
- WebSocket接続のたびに大量のログがコンソールに出力される
- 特に「WebSocket /ws/[UUID]" [accepted]」「connection open」「connection closed」などのログが頻繁に出力
- 実際に必要なログが埋もれてしまい、デバッグや問題解決が困難になる
- uvicornのデフォルトログレベル（INFO）では接続情報が全て出力される

### 実装計画
1. ログフィルタリング機能の強化
   - WebSocket関連ログの特定と制御
   - uvicornロガーのカスタマイズ
   - 不要なログの抑制設定

2. コマンドラインからのログレベル制御
   - ユーザーがログレベルを指定できるオプションの追加
   - 実行時のログレベル設定機能

3. デバッグモードでのログ出力制御
   - 必要に応じてログを有効化する仕組み
   - 条件付きログ出力の実装

### 実装結果
1. ✅ WebSocket関連ログの抑制
   - **ロギング設定の更新**: WebSocketログを制御するためのフィルター追加
   - **デフォルトログレベル変更**: uvicorn.errorとuvicorn.accessのログレベルをWARNINGに変更
   - **websocketsロガー制御**: websocketsパッケージのログレベルもWARNINGに設定

2. ✅ ログレベル設定オプションの追加
   - **コマンドラインオプション**: `--log-level`オプションを追加し、debug/info/warning/error/criticalを選択可能に
   - **動的ログレベル設定**: アプリケーション起動時にログレベルを設定する機能
   - **uvicorn連携**: uvicornのlog_levelパラメータと連携

3. ✅ ファイルパスベースのフィルタリング強化
   - **無視パス追加**: `/ws/`を無視パスリストに追加
   - **ミドルウェア改善**: LogFilterMiddlewareの処理を最適化
   - **設定機能の強化**: set_uvicorn_log_levelヘルパー関数の実装

## 15. 言語対応と出力最適化機能の実装（2025-03-21）

### 実装前の問題点
- 日本語での質問に英語で回答するなど、言語対応が不十分
- AIの思考プロセスと最終結果が混在し、ユーザーにとって読みづらい
- 生成されたファイルへの適切なリンクや説明が不足している
- アプリケーション設計やプロトタイプなどの自動生成機能がない

### 実装計画
1. 言語検出と多言語対応
   - 入力テキストから言語を自動検出する機能
   - 検出した言語で応答するよう設定
   - 多言語テンプレートの整備

2. 出力フォーマットの最適化
   - 思考プロセスと最終結果を分離
   - 不要なデバッグ情報の除外
   - 結果表示の美化

3. ファイル生成機能の強化
   - アプリケーション設計書テンプレート
   - プロトタイプHTMLテンプレート
   - ファイル生成時の自動説明

4. コンポーネント間の連携強化
   - 言語設定の共有
   - ファイル生成情報の共有
   - コマンドライン引数によるカスタマイズ

### 実装結果
1. ✅ 言語検出と多言語対応の実装
   - **言語ユーティリティ**: `app/utils/language_utils.py` - 入力から言語を検出する機能
   - **多言語テンプレート**: よく使われるメッセージの多言語化対応
   - **コマンドライン言語設定**: `--language` オプションで明示的に言語指定が可能に

2. ✅ 出力フォーマットの最適化
   - **出力フォーマッタ**: `app/utils/output_formatter.py` - 思考プロセスと結果を区別
   - **正規表現フィルタリング**: デバッグ情報や中間処理表示を排除
   - **整形関数**: ツール実行結果やエラーメッセージを適切に整形

3. ✅ ファイル生成機能の強化
   - **ファイルテンプレート**: `app/utils/file_templates.py` - アプリ設計書やプロトタイプなどのテンプレート
   - **自動検出と生成**: アプリケーション設計に関連するキーワードを検出すると自動的にファイルを生成
   - **ブラウザプレビュー**: 生成されたHTMLはブラウザで即時プレビュー可能

4. ✅ EnhancedManusクラスの実装
   - **強化エージェント**: `app/agent/enhanced_manus.py` - 全機能を統合した拡張版エージェント
   - **WebUIとの連携**: `app/web/enhanced_agent_factory.py` - Web用エージェント工場
   - **メインモジュール更新**: `main.py` - デフォルトでEnhancedManusを使用するよう更新

5. ✅ ユーザー体験の向上
   - **明確な応答表示**: 最終結果のみをクリーンに表示
   - **ファイル生成情報**: 生成されたファイルの一覧とリンクを表示
   - **多言語エラーメッセージ**: エラーメッセージも検出言語で表示

6. ✅ 設定と柔軟性の向上
   - **環境変数対応**: 設定を環境変数として保存し、次回起動時も維持
   - **デバッグモード**: 思考プロセスを表示するモードを追加（`--show-thoughts`）
   - **自動生成の制御**: ファイルの自動生成機能を無効化するオプション（`--disable-auto-files`）

## 16. 正規表現パターンのSyntaxError修正（2025-03-21）

### 実装前の問題点
- `app/agent/enhanced_manus.py`ファイルの実行時に以下のエラーが発生する
- `app_name_match = re.search(r'app(?:\s+name)?[:\s]+(["\'']?)([^"\':\n]+)\1', result, re.IGNORECASE)`の行でSyntaxError
- 閉じ括弧 `]` が開き括弧 `(` と一致していないというエラー
- 文字クラス内のシングルクォート文字が異なる種類（`'` と `'`）が混在している

### 実装計画
1. 正規表現パターンの分析と修正
   - 問題のある文字クラスの特定
   - 正規表現パターンの正しい修正方法の検討

2. 修正の実装
   - ファイルの更新
   - 修正後のファイルの動作確認

### 実装結果
1. ✅ 問題の特定と分析
   - **エラー箇所の特定**: 140行目の `(["\'']?)` の部分にエラーがあることを確認
   - **原因の特定**: シングルクォート文字 `'` と別の特殊な文字 `'` が混在していることを確認

2. ✅ 修正の実装
   - **新しいファイルを作成**: `app/agent/enhanced_manus_fixed.py` として修正版を作成
   - **正規表現パターンを修正**: `(["\'"]?)` に統一（シングルクォートとダブルクォートのみの文字クラス）
   - **ファクトリーのインポート修正**: `app/web/enhanced_agent_factory.py` を更新して修正版ファイルをインポートするよう変更

3. ✅ 実装計画の更新
   - **実装計画に項目追加**: 修正内容と実装結果をIMPLEMENTATION_PLAN.mdに追加
